<div class="player-search-component relative">
  <input type="text" class="player-search-input p-2 border rounded-md w-full" placeholder="Search for a player..." id="player-search-input" />
  <ul class="player-search-list mt-2 bg-white shadow-lg rounded-md absolute w-full max-h-60 overflow-y-auto z-10" id="player-search-results"></ul>
</div>

<%= javascript_tag do %>
  document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('player-search-input');
    const resultsList = document.getElementById('player-search-results');

    input.addEventListener('input', async function() {
      const query = input.value.trim();

      if (query.length === 0) {
        resultsList.innerHTML = ''; // Clear the list if no query
        return;
      }

      try {
        const response = await fetch(`/player_search?query=${encodeURIComponent(query)}`);

        if (!response.ok) {
          throw new Error('Failed to fetch players');
        }

        const players = await response.json();
        resultsList.innerHTML = '';

        if (players.length === 0) {
          const noResultsItem = document.createElement('li');
          noResultsItem.textContent = 'No results found';
          noResultsItem.classList.add('p-2', 'text-gray-500');
          resultsList.appendChild(noResultsItem);
        } else {
          players.forEach(player => {
            const listItem = document.createElement('li');
            listItem.classList.add('p-2', 'border-b', 'border-gray-300', 'rounded-lg', 'hover:bg-gray-100', 'transition-all', 'duration-200');

            const playerLink = document.createElement('a');
            playerLink.href = `/players/${player.slug}`;
            playerLink.textContent = player.name;
            playerLink.classList.add('block', 'text-gray-800', 'font-medium', 'hover:text-blue-600');

            listItem.appendChild(playerLink);
            resultsList.appendChild(listItem);
          });
        }
      } catch (error) {
        console.error('Error fetching player data:', error);
      }
    });
  });
<% end %>

